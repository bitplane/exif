#!/bin/sh

echo "Checking required tools..."

# Check Python
if ! command -v python3 >/dev/null 2>&1; then
    echo "❌ python3 not found"
    exit 1
else
    echo "✓ python3 found: $(python3 --version)"
fi

# Check Python venv module
if ! python3 -m venv --help >/dev/null 2>&1; then
    echo "❌ python3 venv module not found"
    echo "  Install with: apt-get install python3-venv (Debian/Ubuntu)"
    echo "  or: dnf install python3-venv (Fedora)"
    exit 1
else
    echo "✓ python3 venv module found"
fi

# Check pip
if ! python3 -m pip --version >/dev/null 2>&1; then
    echo "❌ python3 pip module not found"
    echo "  Install with: apt-get install python3-pip (Debian/Ubuntu)"
    exit 1
else
    echo "✓ python3 pip found: $(python3 -m pip --version)"
fi

# Check exiftool
if ! command -v exiftool >/dev/null 2>&1; then
    echo "❌ exiftool not found"
    echo "  Install with: apt-get install libimage-exiftool-perl (Debian/Ubuntu)"
    echo "  or: dnf install perl-Image-ExifTool (Fedora)"
    echo "  or: brew install exiftool (macOS)"
    exit 1
else
    echo "✓ exiftool found: $(exiftool -ver)"
fi

# Check ollama
if ! command -v ollama >/dev/null 2>&1; then
    echo "❌ ollama not found"
    echo "  Install from: https://ollama.ai"
    exit 1
else
    echo "✓ ollama found"
    # Check if llama3 is installed
    if ! ollama list | grep -q "llama3"; then
        echo "  ⚠️  llama3 model not found. Run: ollama pull llama3"
    fi
fi

# Check other utilities
for cmd in shuf grep head; do
    if ! command -v $cmd >/dev/null 2>&1; then
        echo "❌ $cmd not found"
        exit 1
    else
        echo "✓ $cmd found"
    fi
done

echo
echo "All required tools found! You can run 'make init' to set up the environment."